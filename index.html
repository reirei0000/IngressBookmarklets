<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ingress Mission CSV Exporter</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; background-color: #f0f0f0; }
        .container { background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 600px; margin: 0 auto; }
        h1 { color: #009688; }
        p { line-height: 1.6; color: #333; }
        .bookmarklet-btn {
            display: inline-block;
            background-color: #009688;
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 5px;
            font-weight: bold;
            font-size: 18px;
            margin-top: 20px;
            border: 2px solid #00796b;
            cursor: move;
        }
        .bookmarklet-btn:hover { background-color: #00796b; }
        .note { font-size: 0.9em; color: #666; margin-top: 30px; }
        textarea { width: 100%; height: 100px; margin-top: 10px; font-size: 0.8em; }
    </style>
</head>
<body>

<div class="container">
    <h1>Mission CSV Exporter</h1>
    <p>Ingressã®ãƒŸãƒƒã‚·ãƒ§ãƒ³ä½œæˆç”»é¢ã‹ã‚‰ã€ãƒŸãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ã‚’CSVå½¢å¼ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚<br>ï¼ˆCSPå›é¿ãƒ»ãƒ•ãƒ«åŸ‹ã‚è¾¼ã¿ç‰ˆï¼‰</p>
    
    <p>ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®<strong>ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼</strong>ã«<br>ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚</p>

    <a href="javascript:(function(){let rows=document.querySelectorAll('.mission');if(rows.length===0){alert('ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚ã€ŒMy Missionsã€ç”»é¢ã§å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚');return;}let missions={};rows.forEach(row=>{let nameEl=row.querySelector('[class*=%22mission-title-%22]');let name=nameEl?nameEl.innerText.trim():%22Unknown%22;let timeEl=row.querySelector('[class*=%22mission-time-%22]');let statusRaw=timeEl?timeEl.innerText.trim():%22%22;let status=statusRaw.split(' ')[0].toUpperCase();let dateInfo=statusRaw.replace(status,'').trim();let typeEl=row.querySelector('.mission-type > span');let type=typeEl?typeEl.innerText.trim():%22-%22;let timeIcon=row.querySelector('.time-icon');let timeVal=timeIcon?timeIcon.nextElementSibling.innerText.trim():%22-%22;let likedIcon=row.querySelector('.liked-icon');let ratingVal=likedIcon?likedIcon.nextElementSibling.innerText.trim():%22-%22;let agentsIcon=row.querySelector('.agents-icon');let completionsStr=agentsIcon?agentsIcon.nextElementSibling.innerText.trim().replace(/,/g,''):%220%22;let completions=parseInt(completionsStr)||0;if(!missions[name]){missions[name]={name,completions,rating:ratingVal,time:timeVal,type,status,date:dateInfo};}else{let prev=missions[name];if(completions>prev.completions){missions[name]={name,completions,rating:ratingVal,time:timeVal,type,status,date:dateInfo};}else if((prev.rating===%22-%22||prev.rating===%22%22)&&ratingVal!==%22-%22&&ratingVal!==%22%22){missions[name]={name,completions,rating:ratingVal,time:timeVal,type,status,date:dateInfo};}}});let csv=%22Mission Name,Completions,Rating,Median Time,Type,Status,Date info\n%22;let count=0;for(let key in missions){let m=missions[key];let safeName=m.name.replace(/%22/g,'%22%22');csv+=`%22${safeName}%22,${m.completions},%22${m.rating}%22,%22${m.time}%22,%22${m.type}%22,%22${m.status}%22,%22${m.date}%22\n`;count++;}if(count===0){alert('ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚');return;}let bom=new Uint8Array([0xEF,0xBB,0xBF]);let blob=new Blob([bom,csv],{type:'text/csv'});let link=document.createElement('a');link.href=URL.createObjectURL(blob);link.download='ingress_missions_'+new Date().toISOString().slice(0,10)+'.csv';document.body.appendChild(link);link.click();document.body.removeChild(link);})();" 
       class="bookmarklet-btn" onclick="return false;">
       ğŸ“¥ CSV Export (v2)
    </a>

    <div class="note">
        <p>ä½¿ã„æ–¹ï¼š<br>Ingress Mission Authoring Tool ã®ã€ŒMy Missionsã€ç”»é¢ã‚’é–‹ãã€ç™»éŒ²ã—ãŸãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
    </div>
</div>

</body>
</html>
